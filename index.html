<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Comparación de Inversiones – VAN y Payback</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f4f7;
    padding: 20px;
}
.container {
    max-width: 900px;
    background: white;
    padding: 20px;
    border-radius: 8px;
}
h1, h2 {
    text-align: center;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 15px;
}
th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
}
button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
}
.resultado {
    background: #eef;
    padding: 10px;
    margin-top: 15px;
}
</style>
</head>

<body>
<div class="container">

<h1>Proyecto de Inversión – 2º Bachillerato</h1>

<label>Nombre del alumno:</label>
<input type="text" id="nombre"><br><br>

<label>Nivel:</label>
<select id="nivel">
    <option value="3">Básico (3 años)</option>
    <option value="6">Medio (6 años)</option>
    <option value="10">Difícil (10 años)</option>
</select>

<button onclick="generar()">Generar proyectos</button>

<div id="proyectos"></div>

<div id="respuestas" style="display:none;">
<h2>Resultados del alumno</h2>

<h3>Proyecto A</h3>
VAN (€): <input type="number" id="vanA">
Payback (años): <input type="number" id="payA">

<h3>Proyecto B</h3>
VAN (€): <input type="number" id="vanB">
Payback (años): <input type="number" id="payB">

<h3>Decisión</h3>
Mejor proyecto según VAN:
<select id="decisionVAN">
    <option>A</option>
    <option>B</option>
</select>

Mejor proyecto según Payback:
<select id="decisionPB">
    <option>A</option>
    <option>B</option>
</select>

<button onclick="corregir()">Corregir</button>
</div>

<div id="resultadoFinal"></div>

</div>

<script>
let tasa;
let años;
let proyectos = {};

function m100(min, max) {
    return Math.floor((Math.random()*(max-min)+min)/100)*100;
}

function generarProyecto(nombre) {
    let inversion = m100(3000, 10000);
    let ingresos = [];
    let gastos = [];

    for (let i = 0; i < años; i++) {
        ingresos.push(m100(1500, 5000));
        gastos.push(Math.random()<0.5 ? m100(500,2000) : 0);
    }

    return { inversion, ingresos, gastos };
}

function generar() {
    años = parseInt(document.getElementById("nivel").value);
    tasa = m100(300,700)/10000;

    proyectos.A = generarProyecto("A");
    proyectos.B = generarProyecto("B");

    let html = `<h2>Tasa de descuento: ${(tasa*100).toFixed(2)}%</h2>`;

    ["A","B"].forEach(p => {
        html += `<h3>Proyecto ${p}</h3>
        <p><strong>Inversión inicial:</strong> ${proyectos[p].inversion} €</p>
        <table>
        <tr><th>Año</th><th>Ingresos (€)</th><th>Gastos (€)</th></tr>`;
        for (let i=0;i<años;i++){
            html+=`<tr>
            <td>${i+1}</td>
            <td>${proyectos[p].ingresos[i]}</td>
            <td>${proyectos[p].gastos[i]}</td>
            </tr>`;
        }
        html += "</table>";
    });

    document.getElementById("proyectos").innerHTML = html;
    document.getElementById("respuestas").style.display="block";
}

function VAN(p) {
    let van = -p.inversion;
    for (let i=0;i<años;i++){
        let flujo = p.ingresos[i]-p.gastos[i];
        van += flujo / Math.pow(1+tasa, i+1);
    }
    return van;
}

function payback(p) {
    let acum = -p.inversion;
    for (let i=0;i<años;i++){
        acum += p.ingresos[i]-p.gastos[i];
        if (acum>=0) return i+1;
    }
    return Infinity;
}

function corregir() {
    let vanA = VAN(proyectos.A);
    let vanB = VAN(proyectos.B);
    let payA = payback(proyectos.A);
    let payB = payback(proyectos.B);

    let nota = 0;
    if (Math.abs(document.getElementById("vanA").value - vanA) < 200) nota+=2.5;
    if (Math.abs(document.getElementById("vanB").value - vanB) < 200) nota+=2.5;
    if (document.getElementById("payA").value == payA) nota+=1.25;
    if (document.getElementById("payB").value == payB) nota+=1.25;

    if (document.getElementById("decisionVAN").value ==
        (vanA>vanB?"A":"B")) nota+=1.25;

    if (document.getElementById("decisionPB").value ==
        (payA<payB?"A":"B")) nota+=1.25;

    document.getElementById("resultadoFinal").innerHTML=`
    <div class="resultado">
    <p><strong>VAN A:</strong> ${vanA.toFixed(0)} €</p>
    <p><strong>VAN B:</strong> ${vanB.toFixed(0)} €</p>
    <p><strong>Payback A:</strong> ${payA}</p>
    <p><strong>Payback B:</strong> ${payB}</p>
    <h3>Nota final: ${nota}/10</h3>
    </div>`;
}
</script>

</body>
</html>

