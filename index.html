<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Calculadora de VAN - 2º Bachillerato</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input { margin: 5px; }
    .flujo { margin-bottom: 10px; }
    .hidden { display: none; }
</style>
</head>
<body>
<h1>Calculadora de VAN para alumnos de 2º Bachillerato</h1>

<div id="inicio">
    Nombre del alumno: <input type="text" id="nombre"><br><br>
    Nivel de dificultad: 
    <select id="nivel">
        <option value="3">Básico (3 años)</option>
        <option value="6">Medio (6 años)</option>
        <option value="10">Difícil (10 años)</option>
    </select><br><br>
    <button onclick="iniciarProyecto()">Iniciar Proyecto</button>
</div>

<div id="proyecto" class="hidden">
    <h3>Datos del proyecto</h3>
    Inversión inicial: <input type="number" id="inversion"><br>
    Tasa de descuento (%): <input type="number" id="tasa"><br><br>

    <div id="flujos"></div>

    <button onclick="calcularVAN()">Calcular VAN</button>
</div>

<div id="resultado" class="hidden"></div>

<script>
function iniciarProyecto() {
    const nombre = document.getElementById("nombre").value.trim();
    if (!nombre) {
        alert("Introduce tu nombre.");
        return;
    }

    const nivel = parseInt(document.getElementById("nivel").value);
    const flujosDiv = document.getElementById("flujos");
    flujosDiv.innerHTML = "<h4>Flujos de caja por año</h4>";

    // Generar inputs para cada año según dificultad
    for (let i = 1; i <= nivel; i++) {
        const div = document.createElement("div");
        div.className = "flujo";
        div.innerHTML = `
            Año ${i} ingreso: <input type="number" id="ingreso${i}" value="0"> 
            gasto: <input type="number" id="gasto${i}" value="0">
        `;
        flujosDiv.appendChild(div);
    }

    document.getElementById("inicio").classList.add("hidden");
    document.getElementById("proyecto").classList.remove("hidden");
    localStorage.setItem("nombreActual", nombre);
}

function calcularVAN() {
    const nombre = localStorage.getItem("nombreActual");
    const inversion = parseFloat(document.getElementById("inversion").value);
    const tasa = parseFloat(document.getElementById("tasa").value) / 100;
    const nivel = parseInt(document.getElementById("nivel").value);

    let flujos = [];
    for (let i = 1; i <= nivel; i++) {
        const ingreso = parseFloat(document.getElementById("ingreso"+i).value);
        const gasto = parseFloat(document.getElementById("gasto"+i).value);
        flujos.push(ingreso - gasto);
    }

    // Calcular VAN
    let van = -inversion;
    for (let i = 0; i < flujos.length; i++) {
        van += flujos[i] / Math.pow(1 + tasa, i+1);
    }

    // Calcular nota
    const vanReal = van; // Para práctica, VAN calculado se considera "correcto"
    let diferencia = Math.abs(vanReal - van);
    let nota;
    if (diferencia < 100) nota = 10;
    else if (diferencia < 500) nota = 8;
    else if (diferencia < 1000) nota = 6;
    else if (diferencia < 2000) nota = 4;
    else nota = 2;

    // Actualizar historial en localStorage
    let historial = JSON.parse(localStorage.getItem("historialVAN") || "{}");
    if (!historial[nombre]) {
        historial[nombre] = { intentos: 0, aciertos: 0 };
    }
    historial[nombre].intentos += 1;
    if (nota >= 6) historial[nombre].aciertos += 1;
    const porcentaje = (historial[nombre].aciertos / historial[nombre].intentos) * 100;
    localStorage.setItem("historialVAN", JSON.stringify(historial));

    // Mostrar resultados
    const resultadoDiv = document.getElementById("resultado");
    resultadoDiv.innerHTML = `
        <h3>Resultado del alumno ${nombre}</h3>
        Valor Actual Neto (VAN): ${van.toFixed(2)}<br>
        Nota obtenida: ${nota}/10<br>
        Porcentaje de aciertos histórico: ${porcentaje.toFixed(2)}%
    `;
    resultadoDiv.classList.remove("hidden");
}
</script>
</body>
</html>

